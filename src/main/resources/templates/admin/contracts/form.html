<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin-layout :: layout(~{::title}, 'contracts', ~{::content})}">
<head>
    <title th:text="${contract?.contractId} == null ? 'Thêm Hợp Đồng' : 'Sửa Hợp Đồng'">Thêm Hợp Đồng</title>
</head>
<body>
<div th:fragment="content">
    <div class="flex flex-wrap justify-between gap-3 pb-4">
        <div class="flex min-w-72 flex-col gap-2">
            <h1 class="text-[#111418] dark:text-white text-3xl font-bold leading-tight" th:text="${contract?.contractId} == null ? 'Thêm Hợp Đồng Mới' : 'Sửa Hợp Đồng'">Header</h1>
        </div>
    </div>

    <div class="bg-white dark:bg-slate-800/50 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
        <form th:action="${contract?.contractId} != null ? @{/admin/contracts/update} : @{/admin/contracts/create}" 
              th:object="${contract}" method="post" enctype="multipart/form-data" class="flex flex-col gap-6">
            
            <input type="hidden" th:field="*{contractId}" th:if="${contract?.contractId} != null"/>

            <div>
                <h2 class="text-[#111418] dark:text-white text-xl font-bold pb-3 border-b border-gray-200">Thông Tin Hợp Đồng</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-5">
                    
                    <div class="flex flex-col">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Phòng Ban <span class="text-red-500">*</span></label>
                        <select id="departmentSelect" name="departmentId"
                                onchange="if(!this.value) return; window.location.href = window.location.pathname.includes('create') ? '/admin/contracts/create?departmentId=' + this.value : '/admin/contracts/edit/' + document.getElementById('contractIdHidden').value + '?departmentId=' + this.value"
                                th:if="${contract?.contractId} == null"
                                class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500 cursor-pointer">
                            <option th:each="dept : ${departments}" 
                                    th:value="${dept.departmentId}" 
                                    th:text="${dept.departmentName}" 
                                    th:selected="${selectedDepartmentId == dept.departmentId}">
                            </option>
                        </select>
                        
                        <select onchange="window.location.href = '?departmentId=' + this.value"
                                th:if="${contract?.contractId} != null"
                                class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500 cursor-pointer">
                            <option th:each="dept : ${departments}" 
                                    th:value="${dept.departmentId}" 
                                    th:text="${dept.departmentName}" 
                                    th:selected="${selectedDepartmentId == dept.departmentId}">
                            </option>
                        </select>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Nhân Viên <span class="text-red-500">*</span></label>
                        <select name="empId" class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500 cursor-pointer" required>
                            <option value="">-- Chọn nhân viên --</option>
                            <option th:each="emp : ${employees}" 
                                    th:value="${emp.employeeId}" 
                                    th:text="${emp.MNV + ' - ' + emp.employeeName}" 
                                    th:selected="${contract.employee != null && contract.employee.employeeId == emp.employeeId}">
                            </option>
                        </select>
                        <p th:if="${#lists.isEmpty(employees)}" class="text-xs text-red-500 mt-1">Không có nhân viên nào trong phòng ban này.</p>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Loại Hợp Đồng <span class="text-red-500">*</span></label>
                        <select class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500" th:field="*{contractType}" required>
                            <option value="">Chọn loại</option>
                            <option value="Full-time">Full-time (Toàn thời gian)</option>
                            <option value="Part-time">Part-time (Bán thời gian)</option>
                            <option value="Thử việc">Thử việc</option>
                            <option value="Thời vụ">Thời vụ</option>
                        </select>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Ngày Bắt Đầu <span class="text-red-500">*</span></label>
                        <input class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500" type="date" th:field="*{startDate}" required/>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Ngày Kết Thúc</label>
                        <input class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500" type="date" th:field="*{endDate}"/>
                        <p class="text-xs text-gray-500 mt-1">Để trống nếu là hợp đồng vô thời hạn.</p>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Lương thỏa thuận</label>
                        <input class="w-full rounded-lg border border-gray-300 h-11 px-4 focus:ring-2 focus:ring-blue-500" type="number" th:field="*{salary}"/>
                    </div>

                    <div class="md:col-span-2">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">Ghi chú thêm</label>
                        <textarea class="w-full rounded-lg border border-gray-300 h-24 px-4 py-3 focus:ring-2 focus:ring-blue-500" th:field="*{description}"></textarea>
                    </div>

                    <div class="md:col-span-2">
                        <label class="text-[#111418] dark:text-white text-sm font-medium pb-2">File Hợp Đồng (PDF, Word)</label>
                        <input type="file" name="contractFileUpload" accept=".doc,.docx,.pdf" class="w-full rounded-lg border border-gray-300 h-11 px-4 pt-2 text-sm text-gray-700 file:mr-4 file:py-1 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
                        
                        <div th:if="${contract?.contractFile != null}" class="flex items-center gap-2 mt-2 text-sm text-green-600 bg-green-50 p-2 rounded-lg inline-block">
                             <span class="material-symbols-outlined text-base">description</span>
                             <span>Đã có file: <span th:text="${contract.contractFile}" class="font-semibold"></span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-3 pt-6 border-t border-gray-200">
                <a class="flex items-center justify-center rounded-lg h-10 px-6 bg-gray-100 text-gray-700 font-bold hover:bg-gray-200" th:href="@{/admin/contracts}">Hủy</a>
                <button type="submit" class="flex items-center justify-center rounded-lg h-10 px-6 bg-[#137fec] text-white font-bold hover:bg-blue-600 shadow-sm">
                    <span th:text="${contract?.contractId} == null ? 'Tạo Hợp Đồng' : 'Lưu Hợp Đồng'">Lưu</span>
                </button>
            </div>
        </form>
    </div>
</div>
</body>
</html>